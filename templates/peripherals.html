<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetSentry - Peripheral Monitoring</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .device-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .device-details.active {
            max-height: 1000px;
            transition: max-height 0.5s ease-in;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        @media (min-width: 768px) {
            .custom-scrollbar::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            .custom-scrollbar::-webkit-scrollbar-track {
                background: #F3F4F6;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: #9CA3AF;
                border-radius: 4px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gray-900 shadow-md">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16 items-center">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <img src="{{ url_for('static', filename='icon/net_logo.png') }}" 
                                 alt="NetSentry Logo" class="h-10 w-auto" 
                                 onerror="console.error('Logo not found at expected path. Check the static folder configuration and file location.')">
                        </div>
                        <nav class="hidden md:flex md:space-x-8 ml-6">
                            <a href="/" class="text-gray-400 hover:text-yellow-400 text-sm font-medium">Devices</a>
                            <a href="/network_map" class="text-gray-400 hover:text-yellow-400 text-sm font-medium">Network Map</a>
                            <a href="#" class="text-white hover:text-yellow-400 text-sm font-medium">Peripherals</a>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button class="bg-gray-700 p-2 rounded-full text-gray-300 hover:text-yellow-400 focus:outline-none" title="Refresh" onclick="refreshPage()">
                            <i class="ri-refresh-line text-lg"></i>
                        </button>
                        <div class="relative">
                            <button class="bg-gray-800 rounded-full flex text-sm focus:outline-none">
                                <span class="sr-only">Open user menu</span>
                                <div class="h-8 w-8 rounded-full bg-yellow-500 flex items-center justify-center">
                                    <i class="ri-user-line text-gray-900"></i>
                                </div>
                            </button>
                        </div>
                        <a href="{{ url_for('logout') }}" class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition duration-200">
                            Logout
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
                    <h1 class="text-2xl font-bold text-gray-900">Peripheral Devices</h1>
                    <div class="mt-4 md:mt-0 flex space-x-3">
                        <div class="relative">
                            <input type="text" placeholder="Search peripherals..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm" id="searchInput">
                            <div class="absolute left-3 top-2.5 text-gray-400">
                                <i class="ri-search-line"></i>
                            </div>
                        </div>
                        <button class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <i class="ri-filter-line mr-2"></i> Filter
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3 mb-6">
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-yellow-100 rounded-md p-3">
                                    <i class="ri-time-line text-yellow-600 text-xl"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Pending Approval</dt>
                                        <dd class="flex items-baseline">
                                            <div class="text-2xl font-semibold text-gray-900">{{ pending_devices|length }}</div>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-green-100 rounded-md p-3">
                                    <i class="ri-checkbox-circle-line text-green-600 text-xl"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Approved</dt>
                                        <dd class="flex items-baseline">
                                            <div class="text-2xl font-semibold text-gray-900">{{ approved_devices|length }}</div>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-red-100 rounded-md p-3">
                                    <i class="ri-close-circle-line text-red-600 text-xl"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Blocked</dt>
                                        <dd class="flex items-baseline">
                                            <div class="text-2xl font-semibold text-gray-900">{{ blocked_devices|length }}</div>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pending Devices Section -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-medium text-gray-900">Pending Approval <span class="ml-2 px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">{{ pending_devices|length }}</span></h2>
                    </div>
                    
                    {% if pending_devices %}
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="divide-y divide-gray-200">
                            {% for id, device in pending_devices.items() %}
                            <div class="p-4 hover:bg-gray-50 transition-colors duration-150">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center min-w-0">
                                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-yellow-100 flex items-center justify-center">
                                            <i class="ri-usb-line text-yellow-600"></i>
                                        </div>
                                        <div class="ml-4 min-w-0">
                                            <div class="flex items-center">
                                                <p class="text-sm font-medium text-gray-900 truncate">{{ device.product }}</p>
                                            </div>
                                            <p class="text-sm text-gray-500 truncate">{{ device.manufacturer }}</p>
                                        </div>
                                    </div>
                                    <div class="ml-4 flex-shrink-0 flex items-center space-x-3">
                                        <form action="/approve/{{ id }}" method="post">
                                            <button type="submit" class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                                <i class="ri-check-line mr-1"></i> Approve
                                            </button>
                                        </form>
                                        <form action="/block/{{ id }}" method="post">
                                            <button type="submit" class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                                <i class="ri-close-line mr-1"></i> Block
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                
                                <!-- Device Details -->
                                <div class="device-details active mt-4 pl-14">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div>
                                            <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider">Device Info</h3>
                                            <div class="mt-2 space-y-1">
                                                <p class="text-sm text-gray-900"><span class="font-medium">Product:</span> {{ device.product }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Manufacturer:</span> {{ device.manufacturer }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Detected at:</span> {{ device.detected_at }}</p>
                                            </div>
                                        </div>
                                        <div>
                                            <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider">Identifiers</h3>
                                            <div class="mt-2 space-y-1">
                                                <p class="text-sm text-gray-900"><span class="font-medium">Vendor ID:</span> {{ device.vendor_id }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Product ID:</span> {{ device.product_id }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Serial:</span> {{ device.serial }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="p-8 text-center">
                            <i class="ri-checkbox-multiple-blank-line text-4xl text-gray-300 mb-2"></i>
                            <h3 class="text-lg font-medium text-gray-900">No pending devices</h3>
                            <p class="text-sm text-gray-500 mt-1">All peripheral devices are currently approved or blocked</p>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Approved Devices Section -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-medium text-gray-900">Approved Devices <span class="ml-2 px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">{{ approved_devices|length }}</span></h2>
                    </div>
                    
                    {% if approved_devices %}
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="divide-y divide-gray-200">
                            {% for id, device in approved_devices.items() %}
                            <div class="p-4 hover:bg-gray-50 transition-colors duration-150">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center min-w-0">
                                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-green-100 flex items-center justify-center">
                                            <i class="ri-usb-line text-green-600"></i>
                                        </div>
                                        <div class="ml-4 min-w-0">
                                            <div class="flex items-center">
                                                <p class="text-sm font-medium text-gray-900 truncate">{{ device.product }}</p>
                                            </div>
                                            <p class="text-sm text-gray-500 truncate">{{ device.manufacturer }}</p>
                                        </div>
                                    </div>
                                    <div class="ml-4 flex-shrink-0 flex items-center space-x-3">
                                        <form action="/block/{{ id }}" method="post">
                                            <button type="submit" class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                                <i class="ri-close-line mr-1"></i> Block
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                
                                <!-- Device Details -->
                                <div class="device-details active mt-4 pl-14">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div>
                                            <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider">Device Info</h3>
                                            <div class="mt-2 space-y-1">
                                                <p class="text-sm text-gray-900"><span class="font-medium">Product:</span> {{ device.product }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Manufacturer:</span> {{ device.manufacturer }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Approved at:</span> {{ device.decision_time }}</p>
                                            </div>
                                        </div>
                                        <div>
                                            <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider">Identifiers</h3>
                                            <div class="mt-2 space-y-1">
                                                <p class="text-sm text-gray-900"><span class="font-medium">Vendor ID:</span> {{ device.vendor_id }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Product ID:</span> {{ device.product_id }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Serial:</span> {{ device.serial }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="p-8 text-center">
                            <i class="ri-checkbox-multiple-blank-line text-4xl text-gray-300 mb-2"></i>
                            <h3 class="text-lg font-medium text-gray-900">No approved devices</h3>
                            <p class="text-sm text-gray-500 mt-1">No peripheral devices have been approved yet</p>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Blocked Devices Section -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-medium text-gray-900">Blocked Devices <span class="ml-2 px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">{{ blocked_devices|length }}</span></h2>
                    </div>
                    
                    {% if blocked_devices %}
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="divide-y divide-gray-200">
                            {% for id, device in blocked_devices.items() %}
                            <div class="p-4 hover:bg-gray-50 transition-colors duration-150">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center min-w-0">
                                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-red-100 flex items-center justify-center">
                                            <i class="ri-usb-line text-red-600"></i>
                                        </div>
                                        <div class="ml-4 min-w-0">
                                            <div class="flex items-center">
                                                <p class="text-sm font-medium text-gray-900 truncate">{{ device.product }}</p>
                                            </div>
                                            <p class="text-sm text-gray-500 truncate">{{ device.manufacturer }}</p>
                                        </div>
                                    </div>
                                    <div class="ml-4 flex-shrink-0 flex items-center space-x-3">
                                        <form action="/approve/{{ id }}" method="post">
                                            <button type="submit" class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                                <i class="ri-check-line mr-1"></i> Approve
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                
                                <!-- Device Details -->
                                <div class="device-details active mt-4 pl-14">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div>
                                            <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider">Device Info</h3>
                                            <div class="mt-2 space-y-1">
                                                <p class="text-sm text-gray-900"><span class="font-medium">Product:</span> {{ device.product }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Manufacturer:</span> {{ device.manufacturer }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Blocked at:</span> {{ device.decision_time }}</p>
                                            </div>
                                        </div>
                                        <div>
                                            <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wider">Identifiers</h3>
                                            <div class="mt-2 space-y-1">
                                                <p class="text-sm text-gray-900"><span class="font-medium">Vendor ID:</span> {{ device.vendor_id }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Product ID:</span> {{ device.product_id }}</p>
                                                <p class="text-sm text-gray-900"><span class="font-medium">Serial:</span> {{ device.serial }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="p-8 text-center">
                            <i class="ri-checkbox-multiple-blank-line text-4xl text-gray-300 mb-2"></i>
                            <h3 class="text-lg font-medium text-gray-900">No blocked devices</h3>
                            <p class="text-sm text-gray-500 mt-1">No peripheral devices have been blocked</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </main>
    </div>

    <script>
        // Refresh the page
        function refreshPage() {
            location.reload();
        }
        
        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            document.querySelectorAll('.divide-y.divide-gray-200 > div').forEach(item => {
                const deviceName = item.querySelector('.text-sm.font-medium.text-gray-900')?.textContent.toLowerCase() || '';
                const manufacturer = item.querySelector('.text-sm.text-gray-500')?.textContent.toLowerCase() || '';
                
                if (deviceName.includes(searchTerm) || manufacturer.includes(searchTerm)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // Auto-refresh data every 30 seconds
        setInterval(function() {
            refreshPage();
        }, 30000);
    </script>
</body>
</html>